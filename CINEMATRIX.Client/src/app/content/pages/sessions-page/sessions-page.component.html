<div class="sessions-wrapper" *ngIf="promoSession; else loading">
  <div class="promo-wrapper">
    <div class="movie-info">
      <span class="movie-title"> {{promoSession.movie.title}}</span>
      <span class="movie-tagline"> {{promoSession.movie.overview}}</span>
      <button class="buy-ticket-button" mat-raised-button (click)="openBuyTicketDialog(promoSession)"> Buy ticket
      </button>
    </div>
    <img class="promo-poster" [src]="'https://image.tmdb.org/t/p/original/' + promoSession.movie.backdropPath"
      style="width:100%">
  </div>

  <h1 class="schedule-title">SCHEDULE OF SESSIONS</h1>

  <div class="filters-wrapper">
    <div class="filter-date">
      <mat-button-toggle-group>
        <mat-button-toggle class="date-toggle" (click)="setSelectedDate(null)">All</mat-button-toggle>
        <mat-button-toggle *ngFor="let date of weekDates" (click)="setSelectedDate(date)">
          <div class="date-toggle">
            <p class="date-toggle-day">{{date | date:'d' }}</p>
            <p class="date-toggle-">{{date | date:'LLLL, EEEE' }}</p>
          </div>
        </mat-button-toggle>
      </mat-button-toggle-group>

      <mat-form-field>
        <mat-label>Choose a date</mat-label>
        <input (ngModel)="selectedDate" (change)="setSelectedDate(selectedDate)" matInput [matDatepicker]="picker">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>

    <mat-accordion>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Pick up a session
          </mat-panel-title>
          <mat-panel-description>
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div class="filter-controls">
          <div class="time-session">
            <mat-selection-list #sessionTimes>
              <mat-list-option>Morning</mat-list-option>
              <mat-list-option>Daytime</mat-list-option>
              <mat-list-option>Evening</mat-list-option>
              <mat-list-option>Night</mat-list-option>
            </mat-selection-list>
          </div>

          <div class="cost-session" *ngIf="seatTypes$ | async as seatTypes; else loading" #seatTypes>
            <mat-selection-list>
              <mat-list-option *ngFor="let seatType of seatTypes.items"> {{seatType.name}}, {{seatType.price}}$
              </mat-list-option>
            </mat-selection-list>
          </div>

          <div class="hall-session" *ngIf="halls$ | async as halls; else loading" #halls>
            <mat-selection-list>
              <mat-list-option *ngFor="let hall of halls.items"> {{hall.name}}, {{hall.description}}
              </mat-list-option>
            </mat-selection-list>
          </div>
        </div>
        <div class="cost-session"></div>
        <div class="hall-session"></div>
      </mat-expansion-panel>
    </mat-accordion>
    <div class="session-list-wrapper">

    </div>
  </div>

  <div class="list-wrapper" *ngIf="sessions$ | async as sessions; else loading">


    <mat-card class="movie-card" *ngFor="let session of sessions.items">
      <ng-container *ngIf="session.movie">
        <mat-card-title-group>
          <mat-card-title>
            <p class="title"> {{ session.movie.title }} </p>
          </mat-card-title>
          <mat-card-subtitle>
            <p class="tagline"> {{ session.movie.tagline }} </p>
            <p class="genres"> {{ session.movie.genres | genresPipe }} </p>
            <p class="time"> Time: {{ session.dateTime | date: "medium" }} </p>
            <p class="runtime"> Runtime: {{ session.movie.runtime | runtimePipe }} </p>
            <p class="hall"> Hall: {{ session.hall.name }} </p>
            <p class="budget"> Budget: {{ session.movie.budget == 0 ? "Unknown" : session.movie.budget }}$ </p>
          </mat-card-subtitle>
          <img class="film-poster" mat-card-image
            [src]="'https://image.tmdb.org/t/p/w600_and_h600_bestv2' + session.movie.backdropPath"
            alt="Film poster" />
        </mat-card-title-group>
        <mat-card-content>
          <div class="overview">
            <p> {{ session.movie.overview }} </p>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <button mat-button routerLink="/details/{{session.movie.id}}">More</button>
          <button mat-button (click)="openBuyTicketDialog(session)">Buy ticket</button>
        </mat-card-actions>
      </ng-container>
    </mat-card>
  </div>
</div>

<ng-template #loading>
  <mat-progress-bar mode="query"></mat-progress-bar>
</ng-template>
